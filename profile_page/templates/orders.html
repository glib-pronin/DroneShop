{% extends 'layout.html' %}
{% block additional_links %} 
    <link rel="stylesheet" href="{{ url_for('profile.static', filename='css/credentials.css') }}">
    <link rel="stylesheet" href="{{ url_for('profile.static', filename='css/destinations.css') }}">
    <link rel="stylesheet" href="{{ url_for('profile.static', filename='css/orders.css') }}">
    <link rel="stylesheet" href="{{ url_for('profile.static', filename='css/progress_bar.css') }}">
{% endblock %}
{% block page_content %}
    <form action="" method="post" id="contact-form">
        {% if orders_dict %}
            <h3>Мої замовлення</h3>
            <div class="form-rows-container">
                {% for order_id, order in orders_dict.items() %}
                    <div class="choose-block">
                        <div class="choose-block-header">
                            <div class="choose-block-header-block">
                                <div class="circle-status 
                                {{ 'completed-circle' if order.status_code == '5' else '' }}
                                {{ 'canceled-circle' if order.status_code == '6' else '' }}"></div>
                                <div class="data-block">
                                    <span class="span-caption min-width">№{{ order_id }} від {{ order.date }}</span>
                                    <p class="order-status-p">{{ order.status }}</p>
                                </div>
                                <div class="data-block">
                                    <span class="span-caption min-width">Номер відправлення</span>
                                    <p>{{ order.shipment_number if order.shipment_number else 'Ще не визначений'  }}</p>
                                </div>
                                <div class="data-block">
                                    <span class="span-caption min-width">Сума замовлення</span>
                                    <p>{{ order.overall_price }}.00 $</p>
                                </div>
                            </div>
                            <div class="choose-block-header-block">
                                {% for p in order.products[:3] %}
                                    <img class="product-image" src="{{ url_for('catalog.static', filename=p.image_path) }}" alt="">
                                {% endfor %}
                                <svg class="cursor-pointer open-body" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M4.4545 7.8295C4.89384 7.39017 5.60616 7.39017 6.0455 7.8295L12 13.784L17.9545 7.8295C18.3938 7.39017 19.1062 7.39017 19.5455 7.8295C19.9848 8.26884 19.9848 8.98116 19.5455 9.4205L12.7955 16.1705C12.3562 16.6098 11.6438 16.6098 11.2045 16.1705L4.4545 9.4205C4.01517 8.98116 4.01517 8.26884 4.4545 7.8295Z" fill="#6D717F"/>
                                </svg>
                            </div>
                        </div>
                        <div class="choose-block-body hide-element" data-status="{{ order.status_code }}">
                            <div>
                                <div class="data-block in-row">
                                    <span class="span-caption">Номер відправлення: </span>
                                    <p>{{ order.shipment_number }}</p>
                                    <svg class="cursor-pointer copy_code" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M7.3335 6.66634C6.96531 6.66634 6.66683 6.96482 6.66683 7.33301V13.333C6.66683 13.7012 6.96531 13.9997 7.3335 13.9997H13.3335C13.7017 13.9997 14.0002 13.7012 14.0002 13.333V7.33301C14.0002 6.96482 13.7017 6.66634 13.3335 6.66634H7.3335ZM5.3335 7.33301C5.3335 6.22844 6.22893 5.33301 7.3335 5.33301H13.3335C14.4381 5.33301 15.3335 6.22844 15.3335 7.33301V13.333C15.3335 14.4376 14.4381 15.333 13.3335 15.333H7.3335C6.22893 15.333 5.3335 14.4376 5.3335 13.333V7.33301Z" fill="black"/>
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M2.6665 2.00033C2.48969 2.00033 2.32012 2.07056 2.1951 2.19559C2.07008 2.32061 1.99984 2.49018 1.99984 2.66699V8.66699C1.99984 8.8438 2.07008 9.01337 2.1951 9.1384C2.32012 9.26342 2.48969 9.33366 2.6665 9.33366H3.33317C3.70136 9.33366 3.99984 9.63214 3.99984 10.0003C3.99984 10.3685 3.70136 10.667 3.33317 10.667H2.6665C2.13607 10.667 1.62736 10.4563 1.25229 10.0812C0.877218 9.70613 0.666504 9.19743 0.666504 8.66699V2.66699C0.666504 2.13656 0.877217 1.62785 1.25229 1.25278C1.62736 0.877706 2.13607 0.666992 2.6665 0.666992H8.6665C9.19694 0.666992 9.70564 0.877706 10.0807 1.25278C10.4558 1.62785 10.6665 2.13656 10.6665 2.66699V3.33366C10.6665 3.70185 10.368 4.00033 9.99984 4.00033C9.63165 4.00033 9.33317 3.70185 9.33317 3.33366V2.66699C9.33317 2.49018 9.26293 2.32061 9.13791 2.19559C9.01288 2.07056 8.84332 2.00033 8.6665 2.00033H2.6665Z" fill="black"/>
                                    </svg>
                                    <svg class="success_copy hide-element" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                        <rect width="16" height="16" fill="url(#pattern0_{{ order_id }})"/>
                                        <defs>
                                            <pattern id="pattern0_{{ order_id }}" patternContentUnits="objectBoundingBox" width="1" height="1">
                                                <use xlink:href="#image0_{{ order_id }}" transform="scale(0.0111111)"/>
                                            </pattern>
                                            <image id="image0_{{ order_id }}" width="90" height="90" preserveAspectRatio="none" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABaCAYAAAA4qEECAAAACXBIWXMAAAsTAAALEwEAmpwYAAAETUlEQVR4nO2dS2jVRxSHv9a0SbGtm4JGhVpS10KtqypKSCsBS+3CFtIH9UnBglYRdSG4M2YlAbsSuuo2TZuFortuFGtJE+HSLrRdtBbNy66aQuKRgRMIITfexzzO/3/ng98m3DuZ+THMzDnzuJDJZDKZTCaTyWQymZpZBWwDDgIDwDAwDtwDpoH/VdP6t3H9zEX9zttaRmYZNgLHgRHgX0Ca1GPgR+AYsIEW5yXgM+AGMO/B3GqaA64DnwIdtBAva0/7O6C51fQIOA+socS8AJwCphIYvFSuDie1TqViB3DXgMFL9RvQQwlwY+Jl4IkBU6vJ1W0QaKegbAJuGTBSatQvwJsUjB5PyzSJLLcs7KYgfAj8Z8A0aVAuGPoY4xwJvCaWSHJtOIxR9mpwkNok8Wj2RxjDjWuzBsyRAMPIexhhc0EnPqljguxKbXK7Louk5LqTep192YAJEkkuqEkWVluO+MSzXFt3xja5DRgz0HiJrLuxE1GnDDRaEunrmPnkSQMNlkSaVA+Cc9pAYyWxXC47eNrzgYGGSmL9o1txwfjcQCPFiPpCGn3DQAPFiK6GPBJQhszcrM4z61SnNadRbzkugdYZwujjJTG5d5m2nWmwvK9CGD1iwChpQq7Xvl+lbWsbLHPIt8nuiNVMSU12rG+w3Bnfx8+2GTBLPA8XiznbRPlbfRp9sMQm9za5abHfp9EDBkwTz8OFY7eHjeQLPo3+wYBxYtBk7xNikVKisxGGi8Ua9Wn0nwYMFGM9eUH3fRpt4QSoGDTZacKn0Y2EqK1gsugQZNLon4AvNXz9uYBjclCjfe2ofAc8t2Tv8UqBTfY+dPzhqVKblin7+QbNtmCy98nQx/JuHnixSvn1mm3FZO/Lu2FPlepe4X/UarYlk70HLL5C8N+B15ow25rJTv1Wk0oV3dmohpssvzG2hFtJX1hOk47V2bMt9uQFvWU98V+psWdb7clBEv/o3WpJ0LO3GO3JQbay0GvFksBsqyY7HSUA6wPeUak8YxixNFwsaK6BOtfM9YAVr9RR8dQmBz1Agz77IInN3m3A5OBHwjoiPP9QWcFsKyYHP+QY6xD6mB5qWcweQ1fsThCBVyLtuDwEzmnk9a2hc38uLbqaSJw00GBJJLfMjYZL2P9qoNFS9stCju35+ls8Bg0YIJF0iYS06/VdKblur7A7FI0uvZguJdUM8AZG2GUkkBDPcinadzHGByV8GGUfRjlsKLCQJuQ6zCGMs7fgw8isxSd+qtFd0AlyRuebQvE6cNOAeVKj7lh40qeZdfag8QjyiQYjydfJvsL1MQOmLpWr0zuUjDZ9VGTCgMETmoVzdSotq7WRfyUw+KE+1P0qLUQH8AlwLXCgM6cbqX2t9vT8cnTqDYDv9dcomjV3Wss6GvJIQNFZpefZDuhJzSE9g3xPt9AWfh5kSv82qp/p11us7rv550EymUwmk8lkMplMhhp5CqaIor9P1Mi+AAAAAElFTkSuQmCC"/>
                                        </defs>
                                    </svg>
                                </div>
                                {% if order.status_code != '6' %}
                                    <div class="progress-container">
                                        <div class="progress-bar selected-{{ order.status_code }}">
                                            <div class="progress"></div>
                                            <div class="steps-container selected-{{ order.status_code }}">
                                                <div class="step">
                                                    <div class="circle"></div>
                                                    <span class="span-caption">Оформлено</span>
                                                </div>
                                                <div class="step">
                                                    <div class="circle"></div>
                                                    <span class="span-caption">Збирається</span>
                                                </div>
                                                <div class="step">
                                                    <div class="circle"></div>
                                                    <span class="span-caption">У дорозі</span>
                                                </div>
                                                <div class="step">
                                                    <div class="circle"></div>
                                                    <span class="span-caption">Доставлено</span>
                                                </div>
                                                <div class="step">
                                                    <div class="circle"></div>
                                                    <span class="span-caption">Отримано</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>                             
                                {% endif %}
                            </div>
                            <span class="span-caption">Інформація про замовлення</span>
                            <div class="product-info">
                                <div class="left-block">
                                    <div class="data-block">
                                        <span class="span-caption min-width">Адреса доставки</span>
                                        <p>Нова Пошта до {{ 'відділення' if order.delivery_type == 'department' else 'поштомату' }}</p>
                                        <p>{{ order.city }}, {{ order.dest }}</p>
                                    </div>
                                    <div class="data-block">
                                        <span class="span-caption min-width">Отримувач</span>
                                        <p>{{ current_user.credentials[0].first_name }} {{ current_user.credentials[0].second_name }}</p>
                                        <p>{{ current_user.credentials[0].phone_number }}</p>
                                    </div>
                                </div>
                                <div class="vertical-line"></div>
                                <div class="right-block">
                                    <div>
                                        <div class="header-title">
                                            <span>Фото</span>
                                            <span>Назва</span>
                                            <span>Ціна</span>
                                            <span>Кількість</span>
                                            <span>Сума</span>
                                        </div>
                                        <div class="products-container">
                                            {% for p in order.products %}
                                                <div class="product-line">
                                                    <img class="product-image" src="{{ url_for('catalog.static', filename=p.image_path) }}" alt="">
                                                    <span>{{ p.name }}</span>
                                                    {% if p.discounted != p.price %}
                                                        <div class="price-container">
                                                            <span class="line-through">{{ p.price }} $</span> <br>
                                                            <span>{{ p.discounted }} $</span>
                                                        </div>
                                                    {% else %}
                                                        <span>{{ p.price }} $</span>
                                                    {% endif %}
                                                    <span>{{ p.count }}</span>
                                                    <span>{{ p.count * p.discounted }} $</span>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="service-data">
                                        <div class="data-block in-row">
                                            <span class="span-caption">Оплата</span>
                                            <p>Накладений платіж</p>
                                        </div>
                                        <div class="data-block in-row">
                                            <span class="span-caption">Доставка</span>
                                            <p>За тарифами перевізника</p>
                                        </div>
                                        <div class="data-block in-row">
                                            <span class="span-caption">Загальна сума</span>
                                            <p>{{ order.overall_price_without_discount }} $</p>
                                        </div>
                                        {% if order.overall_price != order.overall_price_without_discount %}
                                            <div class="data-block in-row">
                                                <span class="span-caption">Заощаджено</span>
                                                <p>{{ order.overall_price_without_discount - order.overall_price }} $</p>
                                            </div>
                                            <div class="data-block in-row">
                                                <span class="span-caption">Разом</span>
                                                <p>{{ order.overall_price }} $</p>
                                            </div>
                                        {% endif %}
                                    </div>
                                    {% if order.status_code != '5' and order.status_code != '6' %}
                                        <button type="button" class="cursor-pointer cancel-order-btn" data-id="{{ order_id }}">СКАСУВАТИ</button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <h3 class="empry-section">У Вас ще немає замовлень.</h3>
        {% endif %}
    </form>
{% endblock %}
{% block modals %}
    <div class="modal-container" id="confirm-order-canceling-container">
        <form action="" class="modal-form" id="confirm-order-canceling-form" method="get">
            <div class="modal-header">
                <div class="modal-header-text">
                    <button type="button" class="current-modal btn-text">Скасувати замолвення?</button>
                </div>
                <button class="cursor-pointer special-btn close-btn" type="button">
                    <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6.5 5.05945L11.1669 0.392578L12.5 1.7257L7.83312 6.39258L12.5 11.0595L11.1669 12.3926L6.5 7.7257L1.83312 12.3926L0.5 11.0595L5.16688 6.39258L0.5 1.7257L1.83312 0.392578L6.5 5.05945Z" fill="#0C122A"/>
                    </svg>
                </button>
            </div>
            <div class="form-body">
                <p id="info-container">Після цього замовлення буде позначене як скасоване.</p>
            </div>
            <div class="buttons">
               <button class="cancel-btn form-btn cursor-pointer close-btn" type="button">ВІДМІНИТИ</button>
                <button class="submit-btn form-btn cursor-pointer" type="submit">ПРОДОВЖИТИ</button>
            </div>
        </form>
    </div>
{% endblock %}
{% block scripts %}
 <script src="{{ url_for('profile.static', filename='js/svg_creation.js') }}"></script>
 <script src="{{ url_for('profile.static', filename='js/orders.js') }}"></script>
{% endblock %}